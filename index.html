<!DOCTYPE html>
<html lang="bg">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="refresh" content="3600" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />
    <link href="style.css" rel="stylesheet" />
    <title>Верди</title>
  </head>
  <body>
    <div class="container-fluid">
      <table class="table table-dark table-striped align-middle">
        <thead class="thead-dark">
          <tr>
            <th scope="col" class="col-6"></th>
            <th scope="col" class="col-2">Ф23</th>
            <th scope="col" class="col-2">ф30</th>
            <th scope="col" class="col-2">ф36</th>
          </tr>
        </thead>
        <tbody id="pizzas"></tbody>
      </table>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"
    ></script>
    <script src="fn.js"></script>
    <script>
      let table = document.getElementById("pizzas");
      fetch("pizza.csv")
        .then((response) => {
          if (!response.ok) throw new Error(`Грешка: ${response.status}`);
          return response.text();
        })
        .then(csvToArray)
        .then((l) => {
          let tableIndex = 0;
          l.forEach((p) => {
            if (!isRowValid(p)) {
              console.log(`Грешка: ред ${tableIndex} съдържа невалиден запис`);
              return;
            }
            if (
              p.display.toLowerCase() !== "all" &&
              getDisplayParam() !== "all" &&
              getDisplayParam() !== p.display
            ) {
              console.log(`Реда се прескача, не е за този екран: ${p.title}`);
              return;
            }
            // име, 23, 30, 36
            let currentRow = table.insertRow(tableIndex);
            currentRow.insertCell(0).innerHTML = p.title;
            currentRow.insertCell(1).innerHTML = `${convertCurrency(
              p.price_23,
              p.currency,
              "bgn"
            )}лв. / ${convertCurrency(p.price_23, p.currency, "eur")}€`;
            currentRow.insertCell(2).innerHTML = `${convertCurrency(
              p.price_30,
              p.currency,
              "bgn"
            )}лв. / ${convertCurrency(p.price_30, p.currency, "eur")}€`;
            currentRow.insertCell(3).innerHTML = `${convertCurrency(
              p.price_36,
              p.currency,
              "bgn"
            )}лв. / ${convertCurrency(p.price_36, p.currency, "eur")}€`;
            tableIndex++;
            // съставки
            let currentRowIngridients = table.insertRow(tableIndex);
            let ingridients = currentRowIngridients.insertCell(0);
            ingridients.innerHTML = p.ingridients;
            ingridients.colSpan = "4";
            tableIndex++;
          });
        })
        .catch(console.log);
    </script>
  </body>
</html>
